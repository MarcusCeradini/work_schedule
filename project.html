<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Schedule by Hour Ranges</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      max-width: 700px;
      margin: auto;
      padding: 10px;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 20px;
      user-select: none;
    }
    .day {
      border: 1px solid #ccc;
      padding: 12px 8px;
      min-height: 90px;
      cursor: pointer;
      position: relative;
      border-radius: 6px;
      background-color: #fefefe;
      transition: background-color 0.3s;
      font-size: 14px;
      -webkit-tap-highlight-color: transparent;
    }
    .day:hover {
      background-color: #e6f7ff;
    }
    .day.full {
      background-color: #ffd6d6;
      cursor: not-allowed;
    }
    .day .date-number {
      font-weight: bold;
      font-size: 1.3em;
      margin-bottom: 6px;
      user-select: none;
    }
    .signup-count {
      margin-top: 8px;
      font-size: 0.9em;
      color: #444;
    }
    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    button {
      padding: 12px 18px;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #007bff;
      background: #007bff;
      color: white;
      transition: background-color 0.3s;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    #monthYear {
      margin: 0 12px;
      font-size: 1.8em;
      user-select: none;
      white-space: nowrap;
    }
    /* Modal styles */
    #modal {
      display: none; /* hidden by default */
      position: fixed;
      top: 0; left: 0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      padding: 10px;
      z-index: 9999;
      -webkit-overflow-scrolling: touch;
    }
    #modalContent {
      background: white;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      text-align: left;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      font-size: 16px;
    }
    #modalContent h3 {
      margin-top: 0;
      font-size: 1.4em;
      user-select: none;
    }
    .signup-entry {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-size: 1em;
      background: #f0f8ff;
      word-break: break-word;
    }
    .signup-entry .time {
      font-weight: bold;
      margin-right: 10px;
    }
    form {
      margin-top: 15px;
      border-top: 1px solid #ccc;
      padding-top: 12px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 1em;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 14px;
      box-sizing: border-box;
      font-size: 1em;
      border: 1.5px solid #ccc;
      border-radius: 6px;
      outline-offset: 2px;
      -webkit-appearance: none;
      appearance: none;
    }
    #closeModalBtn {
      position: absolute;
      top: 10px;
      right: 14px;
      background: #eee;
      border: none;
      font-size: 1.8em;
      cursor: pointer;
      border-radius: 50%;
      width: 34px;
      height: 34px;
      line-height: 34px;
      text-align: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background-color 0.2s;
    }
    #closeModalBtn:hover {
      background: #ccc;
    }
    .error {
      color: red;
      font-size: 0.95em;
      margin-bottom: 10px;
      min-height: 1.2em;
    }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      .calendar {
        grid-template-columns: repeat(4, 1fr);
      }
      button {
        padding: 10px 14px;
        font-size: 1em;
      }
      #monthYear {
        font-size: 1.3em;
      }
      .day {
        min-height: 70px;
        font-size: 13px;
        padding: 10px 6px;
      }
    }
  </style>
</head>
<body>

  <h1>Schedule by Hour Ranges</h1>
  <div class="header">
    <button onclick="changeMonth(-1)" aria-label="Previous Month">&#8592; Prev</button>
    <h2 id="monthYear" aria-live="polite"></h2>
    <button onclick="changeMonth(1)" aria-label="Next Month">Next &#8594;</button>
  </div>

  <div class="calendar" id="calendar" role="list" aria-label="Calendar days"></div>

  <!-- Modal for signups -->
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalDateTitle" tabindex="-1">
    <div id="modalContent">
      <button id="closeModalBtn" title="Close">&times;</button>
      <h3 id="modalDateTitle"></h3>
      <div id="signupsList" tabindex="0" aria-live="polite">
        <!-- existing signups shown here -->
      </div>

      <form id="signupForm">
        <div class="error" id="errorMsg" aria-live="assertive"></div>
        <label for="nameInput">Your Name:</label>
        <input type="text" id="nameInput" required placeholder="Enter your name" autocomplete="name" />

        <label for="startHourSelect">Start Hour:</label>
        <select id="startHourSelect" required aria-describedby="startHourDesc"></select>

        <label for="endHourSelect">End Hour:</label>
        <select id="endHourSelect" required aria-describedby="endHourDesc"></select>

        <button type="submit">Sign Up</button>
      </form>
    </div>
  </div>

<script>
  const MAX_PEOPLE_AT_ONCE = 3; // max people allowed working simultaneously
  const DAILY_START = "09:00";
  const DAILY_END = "18:00";

  let currentDate = new Date();

  // signups format:
  // { 'YYYY-MM-DD': [ { name, startTime, endTime }, ... ] }
  let signups = {};

  // Save signups object to localStorage
  function saveSignups() {
    localStorage.setItem('signups', JSON.stringify(signups));
  }

  // Remove signups from past dates (before today)
  function cleanOldSignups() {
    const todayStr = formatDate(new Date().getFullYear(), new Date().getMonth() + 1, new Date().getDate());
    let changed = false;
    for (const dateStr in signups) {
      if (dateStr < todayStr) {
        delete signups[dateStr];
        changed = true;
      }
    }
    if (changed) saveSignups();
  }

  // Load signups object from localStorage and clean old signups
  function loadSignups() {
    const saved = localStorage.getItem('signups');
    if (saved) {
      signups = JSON.parse(saved);
    }
    cleanOldSignups();
  }

  function renderCalendar() {
    const calendar = document.getElementById('calendar');
    const monthYear = document.getElementById('monthYear');
    calendar.innerHTML = '';

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDay = firstDay.getDay(); // Sunday = 0

    monthYear.textContent = `${firstDay.toLocaleString('default', { month: 'long' })} ${year}`;

    // Fill empty cells for first week day offset
    for (let i = 0; i < startDay; i++) {
      const empty = document.createElement('div');
      calendar.appendChild(empty);
    }

    const today = new Date();
    today.setHours(0,0,0,0); // clear time for date comparison

    for (let day = 1; day <= lastDay.getDate(); day++) {
      const dateStr = formatDate(year, month + 1, day);
      const dayDate = new Date(year, month, day);
      dayDate.setHours(0,0,0,0);

      const dayDiv = document.createElement('div');
      dayDiv.classList.add('day');
      dayDiv.setAttribute('role', 'listitem');
      dayDiv.setAttribute('tabindex', '-1');

      const totalSignups = (signups[dateStr] || []).length;

      dayDiv.innerHTML = `<div class="date-number">${day}</div>
                          <div class="signup-count">${totalSignups} signed up</div>`;

      // Disable past days (not clickable)
      if (dayDate < today) {
        dayDiv.style.backgroundColor = '#f0f0f0';
        dayDiv.style.color = '#999';
        dayDiv.style.cursor = 'not-allowed';
        dayDiv.setAttribute('aria-disabled', 'true');
      } else {
        dayDiv.onclick = () => openModal(dateStr);
        dayDiv.setAttribute('tabindex', '0');
        dayDiv.setAttribute('aria-label', `Day ${day}, ${totalSignups} people signed up. Tap to sign up.`);
        dayDiv.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openModal(dateStr);
          }
        });
      }

      calendar.appendChild(dayDiv);
    }
  }

  function openModal(dateStr) {
    const modal = document.getElementById('modal');
    const modalDateTitle = document.getElementById('modalDateTitle');
    const signupsList = document.getElementById('signupsList');
    const signupForm = document.getElementById('signupForm');
    const errorMsg = document.getElementById('errorMsg');
    const startHourSelect = document.getElementById('startHourSelect');
    const endHourSelect = document.getElementById('endHourSelect');

    modalDateTitle.textContent = `Signups for ${dateStr}`;
    errorMsg.textContent = '';

    // Show existing signups
    signupsList.innerHTML = '';

    if (signups[dateStr] && signups[dateStr].length > 0) {
      signups[dateStr].forEach(entry => {
        const div = document.createElement('div');
        div.classList.add('signup-entry');
        div.innerHTML = `<span class="time">${entry.startTime} - ${entry.endTime}</span> <strong>${entry.name}</strong>`;
        signupsList.appendChild(div);
      });
    } else {
      signupsList.textContent = "No signups yet.";
    }

    // Reset form inputs
    signupForm.reset();

    // Populate start hour options
    startHourSelect.innerHTML = '';
    endHourSelect.innerHTML = '';

    const startHour = parseInt(DAILY_START.split(':')[0], 10);
    const endHour = parseInt(DAILY_END.split(':')[0], 10);

    for (let h = startHour; h < endHour; h++) {
      const option = document.createElement('option');
      option.value = `${String(h).padStart(2, '0')}:00`;
      option.textContent = `${String(h).padStart(2, '0')}:00`;
      startHourSelect.appendChild(option);
    }

    function updateEndHourOptions() {
      const selectedStart = parseInt(startHourSelect.value.split(':')[0], 10);
      endHourSelect.innerHTML = '';
      for (let h = selectedStart + 1; h <= endHour; h++) {
        const option = document.createElement('option');
        option.value = `${String(h).padStart(2, '0')}:00`;
        option.textContent = `${String(h).padStart(2, '0')}:00`;
        endHourSelect.appendChild(option);
      }
    }

    startHourSelect.onchange = updateEndHourOptions;
    updateEndHourOptions();

    // Handle form submission
    signupForm.onsubmit = function(e) {
      e.preventDefault();
      errorMsg.textContent = '';

      const name = document.getElementById('nameInput').value.trim();
      const startTime = startHourSelect.value;
      const endTime = endHourSelect.value;

      if (name.length === 0) {
        errorMsg.textContent = 'Please enter your name.';
        return;
      }
      if (!isValidTimeRange(startTime, endTime)) {
        errorMsg.textContent = 'Invalid time range.';
        return;
      }
      if (hasOverlap(dateStr, startTime, endTime)) {
        errorMsg.textContent = 'Time range overlaps with another signup.';
        return;
      }
      if (wouldExceedMax(dateStr, startTime, endTime)) {
        errorMsg.textContent = 'Max people working at once exceeded for this time.';
        return;
      }

      // Add signup
      if (!signups[dateStr]) {
        signups[dateStr] = [];
      }
      signups[dateStr].push({ name, startTime, endTime });
      saveSignups();
      renderCalendar();
      openModal(dateStr); // Refresh modal display with updated signups
    };

    modal.style.display = 'flex';

    // Focus the modal for accessibility
    modal.focus();
  }

  function closeModal() {
    const modal = document.getElementById('modal');
    modal.style.display = 'none';
  }

  document.getElementById('closeModalBtn').onclick = closeModal;

  // Close modal on background click
  document.getElementById('modal').onclick = function(e) {
    if (e.target === this) closeModal();
  };

  // Keyboard accessibility for modal close on ESC
  document.addEventListener('keydown', (e) => {
    const modal = document.getElementById('modal');
    if (modal.style.display === 'flex' && e.key === 'Escape') {
      closeModal();
    }
  });

  function changeMonth(offset) {
    currentDate.setMonth(currentDate.getMonth() + offset);
    renderCalendar();
  }

  // Utility to format date as YYYY-MM-DD
  function formatDate(year, month, day) {
    return `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
  }

  // Validate that end > start
  function isValidTimeRange(start, end) {
    return (start < end);
  }

  // Check if new time overlaps existing signups on date
  function hasOverlap(dateStr, newStart, newEnd) {
    if (!signups[dateStr]) return false;

    const newStartTime = timeToMinutes(newStart);
    const newEndTime = timeToMinutes(newEnd);

    for (const s of signups[dateStr]) {
      const sStart = timeToMinutes(s.startTime);
      const sEnd = timeToMinutes(s.endTime);
      if (newStartTime < sEnd && newEndTime > sStart) {
        return true;
      }
    }
    return false;
  }

  // Check if adding new signup exceeds max people limit
  function wouldExceedMax(dateStr, newStart, newEnd) {
    const newStartTime = timeToMinutes(newStart);
    const newEndTime = timeToMinutes(newEnd);

    // Count how many signups overlap with new time interval
    if (!signups[dateStr]) return false;

    for (let t = newStartTime; t < newEndTime; t++) {
      let count = 0;
      for (const s of signups[dateStr]) {
        const sStart = timeToMinutes(s.startTime);
        const sEnd = timeToMinutes(s.endTime);
        if (t >= sStart && t < sEnd) {
          count++;
        }
      }
      if (count >= MAX_PEOPLE_AT_ONCE) {
        return true;
      }
    }
    return false;
  }

  // Convert "HH:MM" to minutes since midnight
  function timeToMinutes(t) {
    const [h, m] = t.split(':').map(Number);
    return h * 60 + m;
  }

  // Initialize
  loadSignups();
  renderCalendar();
</script>

<!--   // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC93r-r-kHNFqu1A2KjqSGMBbx44CTwP2w",
  authDomain: "project-for-work-aa517.firebaseapp.com",
  databaseURL: "https://project-for-work-aa517-default-rtdb.firebaseio.com",
  projectId: "project-for-work-aa517",
  storageBucket: "project-for-work-aa517.firebasestorage.app",
  messagingSenderId: "51216544368",
  appId: "1:51216544368:web:92f67608efdef977207ab5",
  measurementId: "G-H9QVKED2J5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app); -->


</body>
</html>
